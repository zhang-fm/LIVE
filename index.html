<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>M3U8 Player</title>
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<style>
html,body{
    margin:0;
    width:100%;
    height:100%;
    background:#000;
}
video{
    width:100%;
    height:100%;
    object-fit:contain;
    background:#000;
}
.tip{
    color:#fff;
    font-size:22px;
    text-align:center;
    position:absolute;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
}
</style>
</head>
<body>

<video id="video"
       controls
       autoplay
       muted
       playsinline
       webkit-playsinline></video>

<div id="tip" class="tip" style="display:none"></div>

<script>
const url = new URLSearchParams(location.search).get('url');
const video = document.getElementById('video');
const tip = document.getElementById('tip');

if (!url) {
    tip.style.display = 'flex';
    tip.innerHTML = `
        使用方法：<br><br>
        域名后加 ?url=你的m3u8<br><br>
        示例：<br>
        https://你的域名/?url=https://example.com/xxx.m3u8
    `;
} else {
    let restored = false;
    const targetVolume = 0.1;

    function restoreVolume() {
        if (restored) return;
        video.muted = false;
        video.volume = targetVolume;
        restored = true;
    }

    // 任意用户行为即恢复音量
    ['click','touchstart','keydown','mousemove'].forEach(ev=>{
        document.addEventListener(ev, restoreVolume, { once:true });
    });

    if (Hls.isSupported()) {
        const hls = new Hls({
            maxBufferLength: 60,
            maxMaxBufferLength: 120,
            startLevel: -1
        });
        hls.loadSource(url);
        hls.attachMedia(video);
    } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
        video.src = url;
    }
}
</script>

</body>
</html>
