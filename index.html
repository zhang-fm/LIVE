<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>M3U8 Player</title>

<link rel="stylesheet" href="https://g.alicdn.com/de/prismplayer/2.15.2/skins/default/aliplayer-min.css" />
<script src="https://g.alicdn.com/de/prismplayer/2.15.2/aliplayer-min.js"></script>

<style>
html,body{
    margin:0;
    width:100%;
    height:100%;
    background:#000;
}
#player{
    width:100%;
    height:100%;
}
.tip{
    color:#fff;
    font-size:22px;
    text-align:center;
    position:absolute;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
}
</style>
</head>
<body>

<div id="player"></div>
<div id="tip" class="tip" style="display:none"></div>

<script>
const url = new URLSearchParams(location.search).get('url');
const tip = document.getElementById('tip');

if (!url) {
    tip.style.display = 'flex';
    tip.innerHTML = `
        使用方法：<br><br>
        域名后加 ?url=你的m3u8<br><br>
        示例：<br>
        https://你的域名/?url=https://example.com/xxx.m3u8
    `;
} else {

    const player = new Aliplayer({
        id: 'player',
        source: url,
        autoplay: true,
        muted: true,          // ⚠️ 必须
        isLive: false,
        preload: true,
        controlBarVisibility: 'always',
        useH5Prism: true,
    }, function () {
        console.log('AliPlayer Ready');
    });

    let restored = false;
    const targetVolume = 0.01;

    function restoreVolume() {
        if (restored) return;
        player.setVolume(targetVolume);
        player.setMute(false);
        restored = true;
    }

    ['click','touchstart','keydown','mousemove'].forEach(ev=>{
        document.addEventListener(ev, restoreVolume, { once:true });
    });
}
</script>

</body>
</html>
