name: IPTV Shushu 试错更新

on:
  # 每天凌晨 0 点和中午 12 点运行一次
  schedule:
    - cron: '0 0,12 * * *'
  # 支持手动点击运行
  workflow_dispatch:
  # 当你修改了 py 文件夹下的文件时触发
  push:
    paths:
      - 'py/**'

jobs:
  update_list:
    runs-on: ubuntu-latest

    steps:
    - name: 检出代码
      uses: actions/checkout@v3

    - name: 设置 Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    - name: 安装依赖
      run: |
        pip install requests

    - name: 运行试错脚本
      run: |
        # 运行脚本并将输出重定向到文件
        # 如果你的脚本已经自带了写文件逻辑，直接 python py/zuboshicuo.py 即可
        # 这里假设脚本只 print 结果，我们将其存为 py/shushu_results.txt
        python py/zuboshicuo.py > py/shushu_results.txt

    - name: 提交结果到仓库
      run: |
        git config --local user.email "github-actions[bot]@users.noreply.github.com"
        git config --local user.name "github-actions[bot]"
        git add py/shushu_results.txt
        # 只有在文件有变动时才提交，防止报错
        git commit -m "自动更新试错列表: $(date +'%Y-%m-%d %H:%M:%S')" || exit 0
        git push
